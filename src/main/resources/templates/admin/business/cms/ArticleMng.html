<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <link rel="stylesheet" href="/css/summernote.css"></link>
  <script type="text/javascript" src="/js/summernote.js"></script>
    <script type="text/javascript" src="/js/summernote-zh-CN.js"></script>
</head>
<div class="content-wrapper">
    <div id="summernote"><p>Hello World</p></div>
    <button onclick="onImageUpload()">上传图片</button>
</div>
<script th:inline="javascript">
	$('#summernote').summernote({
        height: 400,
        placeholder:'请输入文章内容',
		lang : 'zh-CN', // default: 'en-US'  
		focus : true,
        callbacks: {
            onImageUpload: function(files, editor, welEditable) {
                sendFile(files[0],editor,welEditable);
            }
        }
	});
//alert([[${_csrf.parameterName}]]+[[${_csrf.token}]]);
var header = [[${_csrf.headerName}]];
var token =[[${_csrf.token}]];
	function sendFile(files, editor, welEditable) {
		var data = new FormData();
		data.append("files", files);
		$.ajax({
			async : true,
			data : data,
			type : "POST",
			url : "/admin/cms/file/upload",
	        dataType: 'json',
	        responseType: "json",
			cache : false,
			contentType:false,//(可以)			
			processData : false,
		    beforeSend : function(xhr) {
                xhr.setRequestHeader(header, token);
	            },
			success : function(data) {
				editor.insertImage(welEditable, data);
			},
			  error: function(XMLHttpRequest, textStatus, errorThrown) {
		            alert(XMLHttpRequest.status);
		            //alert(XMLHttpRequest.readyState);
		            //alert(textStatus);
			  }

		});
	}
</script>
</html>